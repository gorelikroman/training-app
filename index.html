<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 16px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 24px;
        }

        .complex-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .complex-item {
            padding: 16px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .complex-item:hover {
            background-color: var(--tg-theme-hint-color, #e0e0e0);
        }

        .exercise-container {
            display: none;
        }

        .exercise-container.active {
            display: block;
        }

        .exercise-info {
            margin-bottom: 24px;
        }

        .sets-list {
            margin: 16px 0;
        }

        .set-item {
            padding: 8px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        input {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--tg-theme-hint-color, #e0e0e0);
            border-radius: 4px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }

        button {
            padding: 12px 24px;
            background-color: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 8px;
        }

        button:hover {
            opacity: 0.9;
        }

        .navigation {
            display: flex;
            gap: 8px;
            margin-top: 24px;
        }

        .navigation button {
            flex: 1;
        }

        .history-container {
            display: none;
        }

        .history-container.active {
            display: block;
        }

        .history-item {
            padding: 16px;
            background-color: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèãÔ∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</h1>
        
        <div class="complex-list" id="complexList">
            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–ª–µ–∫—Å–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
        </div>

        <div class="exercise-container" id="exerciseContainer">
            <div class="exercise-info">
                <h2 id="exerciseName"></h2>
                <div id="exerciseDetails"></div>
            </div>

            <div class="sets-list" id="setsList">
                <!-- –°–ø–∏—Å–æ–∫ –ø–æ–¥—Ö–æ–¥–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
            </div>

            <div class="input-group">
                <input type="number" id="weightInput" placeholder="–í–µ—Å">
                <input type="number" id="repsInput" placeholder="–ü–æ–≤—Ç–æ—Ä—ã">
            </div>

            <button onclick="saveSet()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–¥—Ö–æ–¥</button>

            <div class="navigation">
                <button onclick="prevExercise()">‚Üê –ù–∞–∑–∞–¥</button>
                <button onclick="nextExercise()">–î–∞–ª–µ–µ ‚Üí</button>
            </div>
        </div>

        <div class="history-container" id="historyContainer">
            <!-- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JavaScript -->
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        let currentComplex = null;
        let currentExerciseIndex = 0;
        let results = {};

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            tg.expand();
            loadComplexes();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–ø–ª–µ–∫—Å–æ–≤
        async function loadComplexes() {
            try {
                const response = await fetch('/api/complexes');
                const complexes = await response.json();
                
                const complexList = document.getElementById('complexList');
                complexList.innerHTML = complexes.map(complex => `
                    <div class="complex-item" onclick="selectComplex('${complex.id}')">
                        ${complex.name}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading complexes:', error);
            }
        }

        // –í—ã–±–æ—Ä –∫–æ–º–ø–ª–µ–∫—Å–∞
        function selectComplex(complexId) {
            fetch('/api/complexes')
                .then(response => response.json())
                .then(complexes => {
                    currentComplex = complexes.find(c => c.id === complexId);
                    if (currentComplex) {
                        currentExerciseIndex = 0;
                        results = {};
                        showExercise();
                        document.getElementById('complexList').style.display = 'none';
                        document.getElementById('exerciseContainer').classList.add('active');
                    }
                });
        }

        // –ü–æ–∫–∞–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function showExercise() {
            const exercise = currentComplex.exercises[currentExerciseIndex];
            document.getElementById('exerciseName').textContent = exercise.name;
            document.getElementById('exerciseDetails').innerHTML = `
                ${exercise.sets} √ó ${exercise.reps} ‚Äî ${exercise.type}<br>
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–µ—Å: ${exercise.weight} –∫–≥
            `;

            const sets = results[currentExerciseIndex]?.sets || [];
            document.getElementById('setsList').innerHTML = sets.map((set, i) => `
                <div class="set-item">
                    –ü–æ–¥—Ö–æ–¥ ${i + 1}: ${set.weight} –∫–≥ √ó ${set.reps} —Ä–∞–∑
                </div>
            `).join('');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∞
        function saveSet() {
            const weight = document.getElementById('weightInput').value;
            const reps = document.getElementById('repsInput').value;

            if (!weight || !reps) {
                alert('–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π');
                return;
            }

            const key = `${currentExerciseIndex}`;
            const prev = results[key] || { sets: [] };
            results[key] = {
                ...prev,
                sets: [...prev.sets, { weight: Number(weight), reps: Number(reps) }]
            };

            document.getElementById('weightInput').value = '';
            document.getElementById('repsInput').value = '';
            showExercise();
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏
        function prevExercise() {
            if (currentExerciseIndex > 0) {
                currentExerciseIndex--;
                showExercise();
            }
        }

        function nextExercise() {
            if (currentExerciseIndex < currentComplex.exercises.length - 1) {
                currentExerciseIndex++;
                showExercise();
            } else {
                finishTraining();
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        function finishTraining() {
            const trainingData = {
                date: new Date().toISOString(),
                complex: currentComplex.name,
                exercises: Object.entries(results).map(([index, data]) => ({
                    name: currentComplex.exercises[Number(index)].name,
                    sets: data.sets
                }))
            };

            fetch('/api/save-training', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ trainingData })
            }).then(() => {
                alert('–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
                document.getElementById('exerciseContainer').classList.remove('active');
                document.getElementById('complexList').style.display = 'flex';
            });
        }
    </script>
</body>
</html> 